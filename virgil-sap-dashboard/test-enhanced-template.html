<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Enhanced Template Test</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 1200px;
        margin: 50px auto;
        padding: 20px;
      }
      .template-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin: 20px 0;
      }
      .slide-preview {
        width: 100%;
        height: 200px;
        border: 2px dashed #ccc;
        border-radius: 8px;
        padding: 20px;
        margin: 10px 0;
        position: relative;
        overflow: hidden;
      }
      .template-info {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 8px;
        margin: 10px 0;
      }
      button {
        background: #007bff;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 4px;
        cursor: pointer;
        margin: 5px;
      }
      button:hover {
        background: #0056b3;
      }
      .template-selector {
        margin: 20px 0;
      }
      .design-elements {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
      }
      .content {
        position: relative;
        z-index: 10;
      }
    </style>
  </head>
  <body>
    <h1>Enhanced Template Design Test</h1>

    <div class="template-selector">
      <h3>Select Template</h3>
      <button onclick="loadTemplates()">Load Templates</button>
      <div id="templateList"></div>
    </div>

    <div class="template-info">
      <h3>Template Styles</h3>
      <div id="templateStyles">No template selected</div>
    </div>

    <div class="template-grid">
      <div>
        <h4>Marketing Template Preview</h4>
        <div class="slide-preview" id="marketingPreview">
          <div class="design-elements">
            <div
              style="
                position: absolute;
                left: 0;
                top: 0;
                width: 50%;
                height: 100%;
                background: #7c3aed;
                opacity: 0.2;
                border-right: 2px solid #7c3aed;
              "
            ></div>
            <div
              style="
                position: absolute;
                right: 16px;
                top: 16px;
                width: 32px;
                height: 32px;
                border-radius: 50%;
                background: #a855f7;
                opacity: 0.3;
              "
            ></div>
          </div>
          <div class="content" style="margin-left: 2rem; color: #ffffff">
            <h3 style="font-size: 30px; color: #ffffff; margin-bottom: 8px">
              Marketing Strategy
            </h3>
            <div style="color: #1f2937; font-size: 18px">
              • Target audience analysis<br />
              • Campaign objectives<br />
              • Key performance indicators<br />
              • Budget allocation
            </div>
          </div>
        </div>
      </div>

      <div>
        <h4>Modern Template Preview</h4>
        <div class="slide-preview" id="modernPreview">
          <div class="design-elements">
            <div
              style="
                position: absolute;
                left: 0;
                top: 0;
                width: 50%;
                height: 100%;
                background: #3b82f6;
                opacity: 0.2;
                border-right: 2px solid #3b82f6;
              "
            ></div>
            <div
              style="
                position: absolute;
                right: 16px;
                top: 16px;
                width: 32px;
                height: 32px;
                border-radius: 50%;
                background: #1e40af;
                opacity: 0.3;
              "
            ></div>
          </div>
          <div class="content" style="margin-left: 2rem; color: #ffffff">
            <h3 style="font-size: 32px; color: #ffffff; margin-bottom: 8px">
              Modern Design
            </h3>
            <div style="color: #1f2937; font-size: 18px">
              • Clean layout<br />
              • Professional styling<br />
              • Visual hierarchy<br />
              • Brand consistency
            </div>
          </div>
        </div>
      </div>

      <div>
        <h4>Organic Template Preview</h4>
        <div class="slide-preview" id="organicPreview">
          <div class="design-elements">
            <div
              style="
                position: absolute;
                left: 16px;
                top: 16px;
                width: 64px;
                height: 64px;
                border-radius: 50%;
                background: #3b82f6;
                opacity: 0.15;
              "
            ></div>
          </div>
          <div class="content" style="color: #1e40af">
            <h3 style="font-size: 26px; color: #1e40af; margin-bottom: 8px">
              Organic Growth
            </h3>
            <div style="color: #1e293b; font-size: 16px">
              • Natural progression<br />
              • Sustainable approach<br />
              • Balanced development<br />
              • Long-term success
            </div>
          </div>
        </div>
      </div>

      <div>
        <h4>Professional Template Preview</h4>
        <div class="slide-preview" id="professionalPreview">
          <div class="content" style="color: #ffffff">
            <h3 style="font-size: 28px; color: #ffffff; margin-bottom: 8px">
              Executive Summary
            </h3>
            <div style="color: #374151; font-size: 16px">
              • Strategic overview<br />
              • Key insights<br />
              • Business impact<br />
              • Next steps
            </div>
          </div>
        </div>
      </div>
    </div>

    <div>
      <h4>Live Template Preview</h4>
      <div class="slide-preview" id="livePreview">
        <div class="content">
          <h3>Sample Slide Title</h3>
          <p>This is a sample slide content to test template styling.</p>
          <ul>
            <li>Bullet point 1</li>
            <li>Bullet point 2</li>
            <li>Bullet point 3</li>
          </ul>
        </div>
      </div>
    </div>

    <script>
      let currentTemplateStyles = null;

      async function loadTemplates() {
        try {
          const response = await fetch("/api/export/powerpoint/template");

          if (response.ok) {
            const data = await response.json();
            const templates = data.templates || [];

            const templateList = document.getElementById("templateList");
            templateList.innerHTML = templates
              .map(
                (template) => `
                        <div style="margin: 10px 0; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
                            <strong>${template.name}</strong><br>
                            <small>ID: ${template.id}</small><br>
                            <button onclick="selectTemplate('${template.id}')">Select Template</button>
                        </div>
                    `
              )
              .join("");
          }
        } catch (error) {
          console.error("Error loading templates:", error);
        }
      }

      async function selectTemplate(templateId) {
        try {
          const response = await fetch(
            `/api/export/powerpoint/template-styles?id=${templateId}`
          );

          if (response.ok) {
            const styles = await response.json();
            currentTemplateStyles = styles;

            // Update template styles display
            document.getElementById("templateStyles").innerHTML = `
                        <strong>Design:</strong> ${
                          styles.templateDesign || "Unknown"
                        }<br>
                        <strong>Background:</strong> #${
                          styles.slideBackground
                        }<br>
                        <strong>Primary Color:</strong> #${
                          styles.primaryColor
                        }<br>
                        <strong>Secondary Color:</strong> #${
                          styles.secondaryColor
                        }<br>
                        <strong>Title Color:</strong> #${styles.titleColor}<br>
                        <strong>Text Color:</strong> #${styles.textColor}<br>
                        <strong>Font Family:</strong> ${styles.fontFamily}<br>
                        <strong>Title Font Size:</strong> ${
                          styles.titleFontSize
                        }px<br>
                        <strong>Body Font Size:</strong> ${
                          styles.bodyFontSize
                        }px<br>
                        <strong>Has Shapes:</strong> ${
                          styles.hasShapes ? "Yes" : "No"
                        }<br>
                        <strong>Layout Type:</strong> ${
                          styles.layoutType || "Standard"
                        }
                    `;

            // Update live preview
            updateLivePreview(styles);

            console.log("Template styles loaded:", styles);
          }
        } catch (error) {
          console.error("Error loading template styles:", error);
        }
      }

      function updateLivePreview(styles) {
        const preview = document.getElementById("livePreview");

        // Clear existing design elements
        const existingElements = preview.querySelector(".design-elements");
        if (existingElements) {
          existingElements.remove();
        }

        // Apply template styles
        preview.style.background = `#${styles.slideBackground}`;
        preview.style.color = `#${styles.primaryColor}`;
        preview.style.fontFamily = styles.fontFamily;

        // Add design elements based on template type
        if (styles.hasShapes) {
          const designElements = document.createElement("div");
          designElements.className = "design-elements";

          if (
            styles.templateDesign === "marketing" ||
            styles.templateDesign === "modern"
          ) {
            designElements.innerHTML = `
                        <div style="position: absolute; left: 0; top: 0; width: 50%; height: 100%; background: #${styles.primaryColor}; opacity: 0.2; border-right: 2px solid #${styles.primaryColor};"></div>
                        <div style="position: absolute; right: 16px; top: 16px; width: 32px; height: 32px; border-radius: 50%; background: #${styles.accentColor}; opacity: 0.3;"></div>
                    `;
          } else if (styles.templateDesign === "organic") {
            designElements.innerHTML = `
                        <div style="position: absolute; left: 16px; top: 16px; width: 64px; height: 64px; border-radius: 50%; background: #${styles.accentColor}; opacity: 0.15;"></div>
                    `;
          }

          preview.appendChild(designElements);
        }

        // Update content styling
        const content = preview.querySelector(".content");
        if (content) {
          content.style.marginLeft = styles.hasShapes ? "2rem" : "0";
          content.style.fontSize = `${styles.bodyFontSize}px`;

          // Update title
          const title = content.querySelector("h3");
          if (title) {
            title.style.fontSize = `${styles.titleFontSize}px`;
            title.style.color = `#${styles.titleColor}`;
          }

          // Update text
          const text = content.querySelector("p");
          if (text) {
            text.style.color = `#${styles.textColor}`;
          }

          // Update list items
          const listItems = content.querySelectorAll("li");
          listItems.forEach((item) => {
            item.style.color = `#${styles.textColor}`;
          });
        }
      }

      // Load templates on page load
      loadTemplates();
    </script>
  </body>
</html>
